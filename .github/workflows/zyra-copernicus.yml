name: Zyra Copernicus Acquire

on:
  workflow_dispatch:
    inputs:
      DATASET_NAME:
        description: Dataset name (e.g., copernicus)
        required: true
        type: string

env:
  ZYRA_SCHEDULER_IMAGE: ghcr.io/noaa-gsl/zyra-scheduler:latest

jobs:
  acquire-copernicus:
    runs-on: ubuntu-latest
    container:
      image: ghcr.io/noaa-gsl/zyra-scheduler:latest
      options: >-
        --entrypoint ""
        --user 0
    env:
      COPERNICUS_USERNAME: ${{ secrets.COPERNICUS_USERNAME }}
      COPERNICUS_PASSWORD: ${{ secrets.COPERNICUS_PASSWORD }}

    steps:
      - uses: actions/checkout@v4

      - name: Install Copernicus connector (temporary)
        run: pip install 'zyra[datatransfer]' sentinelsat

      - name: Acquire imagery from Copernicus (temporary)
        run: |
          mkdir -p "_work/images/${DATASET_NAME}"
          sentinelsat \
            --user "${COPERNICUS_USERNAME}" \
            --password "${COPERNICUS_PASSWORD}" \
            --sentinel 2 \
            --area "POLYGON((-120 35, -118 35, -118 37, -120 37, -120 35))" \
            --query "beginPosition:[2025-11-01T00:00:00Z TO 2025-11-07T23:59:59Z]" \
            --limit 5 \
            --download "_work/images/${DATASET_NAME}"


      - name: Upload imagery artifacts
        uses: actions/upload-artifact@v4
        with:
          name: copernicus-${{ inputs.DATASET_NAME }}
          path: _work/images/${{ inputs.DATASET_NAME }}
